<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <style>
            canvas {
                border: 1px solid black;
            }
        </style>
    </head>
    <body>
        <canvas width="800" height="600"></canvas>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            let canvas = document.querySelector("canvas")
            let ctx = canvas.getContext("2d")
            var socket = io();
            socket.emit('stage announcement');

            let objects = {}

            socket.on("move", function(msg) {
                if(objects[msg.ID]){
                    objects[msg.ID].x = msg.x
                    objects[msg.ID].y = msg.y
                }
            })

            socket.on("join", function(msg) {
                objects[msg.ID] = {text: msg.word, x: 200, y:300}
            })

            socket.on("leave", function(msg) {
                delete objects[msg.ID]
            })



            function render() {
                update()

                ctx.clearRect(0, 0, canvas.width, canvas.height)
                ctx.fillStyle = "black"
                ctx.font = "30px Arial"
                for ([id,o] of Object.entries(objects)) {
                    ctx.fillText(o.text, o.x, o.y)
                }
                requestAnimationFrame(render)
            }

            function update() {
                //objects[0].x = 100 + Math.sin(Date.now() / 1000) * 100
            }

            render()
        </script>
    </body>
</html>
